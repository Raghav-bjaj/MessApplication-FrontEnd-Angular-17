
<div class="container">
  <!-- Check if the view should be the Admin/Guest view or the Student view -->
  <ng-container *ngIf="(isAdminView$ | async); else studentView">
    <!-- ADMIN / GUEST VIEW -->
    <mat-card class="total-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>search</mat-icon>
        <mat-card-title>Student Total Lookup</mat-card-title>
        <mat-card-subtitle>Enter a registration number to find their total bill.</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <!-- The form is disabled for guests -->
        <form [formGroup]="adminForm" (ngSubmit)="fetchTotal()" class="total-form">
          <mat-form-field appearance="outline"
            matTooltip="Search is disabled for guest accounts."
            [matTooltipDisabled]="!(isGuest$ | async)">
            <mat-label>Registration Number</mat-label>
            <input matInput formControlName="reg" required>
          </mat-form-field>

          <button mat-flat-button color="primary" type="submit" [disabled]="adminForm.invalid || (isGuest$ | async)"
            matTooltip="Search is disabled for guest accounts."
            [matTooltipDisabled]="!(isGuest$ | async)">
            Fetch Total
          </button>
        </form>

        <!-- Display the fetched total for admin/guest -->
        <div *ngIf="responseMessage" class="response-container">
          <h3>{{ responseMessage }}</h3>
          <p class="total-amount" *ngIf="adminTotal !== undefined">₹{{ adminTotal }}</p>
        </div>
      </mat-card-content>
    </mat-card>
  </ng-container>

  <!-- STUDENT VIEW -->
  <ng-template #studentView>
    <ng-container *ngIf="{ total: (studentTotal$ | async), regNo: (regNo$ | async) } as data">
      <mat-card class="total-card student-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>receipt_long</mat-icon>
          <mat-card-title>My Meal Bill</mat-card-title>
          <mat-card-subtitle>Reg No: {{ data.regNo }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="student-total-display">
            <p *ngIf="data.total !== null; else loading">₹{{ data.total }}</p>
            <ng-template #loading>
              <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
            </ng-template>
          </div>
        </mat-card-content>
      </mat-card>
    </ng-container>
  </ng-template>
</div>